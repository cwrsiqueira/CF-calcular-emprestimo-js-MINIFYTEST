window.addEventListener("load",(function(){const flipcardfront=document.querySelector(".flip-card-front").offsetHeight;const botoesextras=document.querySelector(".botoes-extras");botoesextras.style.marginTop=flipcardfront-400+"px"}));$(".value").mask("000.000.000,00",{reverse:true});$(".percent").mask("00,00",{reverse:true});document.getElementById("periodo").value=sessionStorage.getItem("periodo")||"";document.getElementById("txPeriodo").value=sessionStorage.getItem("txPeriodo")||"";document.getElementById("vlrEmprestimo").value=sessionStorage.getItem("vlrEmprestimo")||"";document.getElementById("vlrParcela").value=sessionStorage.getItem("vlrParcela")||"";document.getElementById("tipoAmortizacao").value=sessionStorage.getItem("tipoAmortizacao")||"price";document.querySelector("#btn-reset").addEventListener("click",(function(){sessionStorage.clear()}));function calcularemprestimo(){const periodo=document.getElementById("periodo").value;const txPeriodo=document.getElementById("txPeriodo").value;const vlrEmprestimo=document.getElementById("vlrEmprestimo").value;const vlrParcela=document.getElementById("vlrParcela").value;const tipoAmortizacao=document.getElementById("tipoAmortizacao").value;sessionStorage.setItem("periodo",periodo);sessionStorage.setItem("txPeriodo",txPeriodo);sessionStorage.setItem("vlrEmprestimo",vlrEmprestimo);sessionStorage.setItem("vlrParcela",vlrParcela);sessionStorage.setItem("tipoAmortizacao",tipoAmortizacao);let camposPreenchidos=[periodo,txPeriodo,vlrEmprestimo,vlrParcela,tipoAmortizacao];let totalCamposNPreenchidos=0;let campoEmBranco=-1;camposPreenchidos.forEach(((item,index)=>{if(item===""){totalCamposNPreenchidos++;campoEmBranco=index}}));if(totalCamposNPreenchidos!==1){alert("Deixe apenas um campo em branco para cálculo.");return}function formatarValor(valor,sistema=true){if(sistema){return valor.replace(/\./g,"").replace(",",".")}else{return valor.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")}}function calcularAnosEMeses(totalMeses){const anos=Math.floor(totalMeses/12);const meses=totalMeses%12;const anoTexto=anos===1?"1 ano":`${anos} anos`;const mesTexto=meses===1?"1 mês":`${meses} meses`;if(anos===0){return mesTexto}if(meses===0){return`${totalMeses} meses (ou ${anoTexto})`}return`${totalMeses} meses (ou ${anoTexto} e ${mesTexto})`}let prazo=periodo?periodo:0,taxa=txPeriodo?parseFloat(formatarValor(txPeriodo)):0,emprestimo=vlrEmprestimo?parseFloat(formatarValor(vlrEmprestimo)):0,parcela=vlrParcela?parseFloat(formatarValor(vlrParcela)):0,parcelaInicial=0,parcelaFinal=0,total=0,juros=0;switch(campoEmBranco){case 0:if(tipoAmortizacao==="price"){saldoDevedor=emprestimo;prazo=0;while(saldoDevedor>.01){saldoDevedor=saldoDevedor-parcela+saldoDevedor*(taxa/100);console.log(saldoDevedor>parcela,prazo<=999);prazo++;if(prazo>999){break}}}parcelaInicial=parcela;parcelaFinal=parcela;total=parcela*prazo;juros=total-emprestimo;break;case 1:console.log("Calcular Taxa");prazo=0;taxa=0;emprestimo=0;parcelaInicial=0;parcelaFinal=0;total=0;juros=0;break;case 2:console.log("Calcular Empréstimo");prazo=0;taxa=0;emprestimo=0;parcelaInicial=0;parcelaFinal=0;total=0;juros=0;break;case 3:let calcParcela=0;let calcParcelaFinal=0;let calcTotal=0;let calcJuros=0;if(tipoAmortizacao==="price"){calcParcela=emprestimo*(taxa/100)/(1-Math.pow(1+taxa/100,-prazo));calcParcelaFinal=calcParcela;calcTotal=prazo*calcParcela;calcJuros=prazo*calcParcela-emprestimo}let parcelas=[];if(tipoAmortizacao==="sac"){saldoDevedor=emprestimo;amortizacaoMensal=saldoDevedor/prazo;for(i=1;i<=prazo;i++){parcelaNr=i;juros=saldoDevedor*(taxa/100);amortizacaoMensal;parcelaValor=parseFloat((juros+amortizacaoMensal).toFixed(2));saldoDevedor=parseFloat((saldoDevedor+juros-parcelaValor).toFixed(2));calcTotal+=parcelaValor;calcJuros+=juros;parcelas.push({parcelaNr:parcelaNr,juros:juros,amortizacaoMensal:amortizacaoMensal,parcelaValor:parcelaValor,saldoDevedor:saldoDevedor})}calcParcela=parcelas[0].parcelaValor;calcParcelaFinal=parcelas[parcelas.length-1].parcelaValor}prazo=prazo;taxa=taxa;emprestimo=emprestimo;parcelaInicial=calcParcela;parcelaFinal=calcParcelaFinal;total=calcTotal;juros=calcJuros;break}if(emprestimo==Infinity||parcelaInicial==Infinity||parcelaFinal==Infinity||total==Infinity||juros==Infinity){alert("Valores informados levam a resultados infinitos ou . Verifique os valores e tente novamente.");return false}anosEMeses=calcularAnosEMeses(prazo);sessionStorage.setItem("prazo",prazo?anosEMeses:"N/A");sessionStorage.setItem("parcelaInicial",parcelaInicial?formatarValor(parcelaInicial,false):"N/A");sessionStorage.setItem("parcelaFinal",parcelaFinal?formatarValor(parcelaFinal,false):"N/A");sessionStorage.setItem("emprestimo",emprestimo?formatarValor(emprestimo,false):"N/A");sessionStorage.setItem("juros",juros?formatarValor(juros,false):"N/A");sessionStorage.setItem("taxa",taxa?formatarValor(taxa,false):"N/A");sessionStorage.setItem("total",total?formatarValor(total,false):"N/A");document.querySelector(".flip-card").classList.add("flip-card-flipped");setTimeout((()=>{window.location.href="results.min.html"}),500)}function voltarFormulario(e){e.preventDefault();document.querySelector(".flip-card").classList.remove("flip-card-flipped");setTimeout((()=>{window.location.href="index.min.html"}),500)}document.getElementById("calcularBtn").addEventListener("click",calcularemprestimo);if(document.getElementById("voltarBtn")){document.getElementById("voltarBtn").addEventListener("click",voltarFormulario)}if(document.getElementById("resultPrazo")){document.getElementById("resultPrazo").textContent=`Prazo: ${sessionStorage.getItem("prazo")||"---"}`;document.getElementById("resultParcelaInicial").textContent=`Parcela Inicial: $ ${sessionStorage.getItem("parcelaInicial")||"---"}`;document.getElementById("resultParcelaFinal").textContent=`Parcela Final: $ ${sessionStorage.getItem("parcelaFinal")||"---"}`;document.getElementById("resultEmprestimo").textContent=`Valor do Empréstimo: $ ${sessionStorage.getItem("emprestimo")||"---"}`;document.getElementById("resultJuros").textContent=`Juros Totais: $ ${sessionStorage.getItem("juros")||"---"}`;document.getElementById("resultTaxa").textContent=`Taxa Mensal: ${sessionStorage.getItem("taxa")||"---"}%`;document.getElementById("resultTotal").textContent=`Total a Pagar: $ ${sessionStorage.getItem("total")||"---"}`;document.getElementById("resultSistema").textContent=`Sistema de Amortização: ${sessionStorage.getItem("tipoAmortizacao")==="price"?"Tabela PRICE":"Tabela SAC"}`}if(document.getElementById("copiarBtn")){document.getElementById("copiarBtn").addEventListener("click",(function(){const prazo=document.getElementById("resultPrazo").textContent;const parcelaInicial=document.getElementById("resultParcelaInicial").textContent;const parcelaFinal=document.getElementById("resultParcelaFinal").textContent;const emprestimo=document.getElementById("resultEmprestimo").textContent;const juros=document.getElementById("resultJuros").textContent;const taxa=document.getElementById("resultTaxa").textContent;const total=document.getElementById("resultTotal").textContent;const tipoAmortizacao=document.getElementById("resultSistema").textContent;const resultado=`Calcular Empréstimo\nhttps://www.calcularemprestimo.com\n\nResultados\n${emprestimo}\n${prazo}\n${taxa}\n${tipoAmortizacao}\n${parcelaInicial}\n${parcelaFinal}\n${total}\n${juros}\n`;navigator.clipboard.writeText(resultado).then((()=>{alert("Resultados copiados para a área de transferência!")})).catch((err=>{alert("Erro ao copiar os resultados. Tente novamente.");console.error("Erro ao copiar",err)}))}))}